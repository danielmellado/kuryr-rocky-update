<!DOCTYPE html>
<html>
  <head>
    <title>
        Kuryr - Project Update
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="slides.css"></link>
  </head>
  <body>
    <textarea id="source">

layout: true
name: title_layout
class: title_slide

---

layout: true
name: section_layout
class: section_slide

---

layout: true
name: agenda_layout
class: content_slide agenda_slide

---

layout: true
name: thank_you
class: thank_you

---

layout: true
name: content_layout
class: content_slide

---

template: title_layout

# Kuryr

## Project Update

Daniel Mellado - Senior Software Engineer - Red Hat<br />
<br>
Open Infrastructure Summit Denver, 30.04.2019<br />

---

template: agenda_layout

# Agenda

1. What's Kuryr?
2. Kuryr-Kubernetes update (Stein)
3. Kuryr-Kubernetes future (Train, U)

Slides available at: **https://danielmellado.github.io/kuryr-stein-update**

---

template: section_layout

What's Kuryr?

---
# Kuryr-Kubernetes

## Logos or mascots


#.left-column[![Insert graphic here](assets/kuryr-logo.png)]

--

#.right-column[.center[.half[![Insert graphic here](assets/kuryr-logo2.png)]]]

---

# Kuryr

## Deliverables

### In active development:

* *kuryr-kubernetes*
  * CNI plugin using Neutron to provide networking for K8s Pods.
  * Controller providing K8s Services using Octavia or Neutron LBaaS v2.
* *kuryr-tempest-plugin* - tests for kuryr-kubernetes

--

### Maintained:

* *kuryr* - docker network plugin
* *kuryr-libnetwork* - docker libnetwork plugin

--

### Retired (in Stein):

* *fuxi*
* *fuxi-kubernetes*
* *fuxi-golang*

---

template: section_layout

Kuryr-Kubernetes update (Stein)

---

# Kuryr-Kubernetes update (Stein)

## Deprecations

* Running without kuryr-daemon is now deprecated.
  * Removed in Stein.
--

* LBaaS v2 support is now deprecated

---

# Kuryr-Kubernetes update (Stein)

## Kubernetes/OpenShift releases compatiblity

<table border="1">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Kuryr-Kubernetes version</th>
<th class="head">Kubernetes version</th>
<th class="head">OpenShift Origin version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>1.0.0 (Stein)</strong></td>
<td><strong>v1.9.x, 1.10.x, 1.11.x, 1.12.x, 1.13.x</strong></td>
<td><strong>3.9, 3.10</strong></td>
</tr>
<tr class="row-odd"><td>0.5.x (Rocky)</td>
<td>v1.9.x, 1.10.x</td>
<td>3.9, 3.10</td>
</tr>
<tr class="row-even"><td>0.4.x (Queens)</td>
<td>v1.8.x</td>
<td>3.7</td>
</tr>
<tr class="row-even"><td>0.3.x (Pike)</td>
<td>v1.6.x, 1.8.x</td>
<td>No support</td>
</tr>
<tr class="row-odd"><td>0.2.x (Ocata)</td>
<td>v1.4.x, 1.6.x</td>
<td>No support</td>
</tr>
<tr class="row-even"><td>0.1.x (Newton)</td>
<td>v1.3.x, 1.4.x</td>
<td>No support</td>
</tr>
</tbody>
</table>

---

# Kuryr-Kubernetes update (Stein)

## Network Policy Support

* Specification of how groups of pods are allowed to communicate with each
  other and other network endpoints..
* Extends k8s implementation by leveraging neutron security groups.
  * Security group rules are parsed from k8s network policies.
  * Uses a CRD for this: 'KuryrNetPolicy'.

---

# Kuryr-Kubernetes update (Stein)

## Network Policy Support

### Network Policy

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-network-policy
  namespace: default
spec:
  <snipped!>
  ingress:
  - from:
    - ipBlock:
        cidr: 172.17.0.0/16
        except:
        - 172.17.1.0/24
    ports:
    - protocol: TCP
      port: 6379
    <snipped!>
```

* More info in Kuryr-Kubernetes documentation.

---

# Kuryr-Kubernetes update (Stein)

## Network Policy Support

New handler and driver for Network Policies

* We now handle network policies events
* KuryrNetPolicy CRD created per k8s np event

---

# Kuryr-Kubernetes update (Stein)

## Network Policy Support


.full[.center[![Network Policy](assets/np.svg)]]

--

* Kuryr handler watches over CRUD operations for Network Policies
--

* Neutron object IDs are stored in KuryrNetPolicy spec
  * This is a way to get faster speeds by avoiding talking to Neutron

---

# Kuryr-Kubernetes update (Stein)

## Project isolation (now with Network Policies)

OpenShift supports basic multitenancy through projects

* We create a new subnet and router per project within a namespace so we ensure proper project isolation.

--
* Whenever a pod is created, proper security groups are assigned to it using the namespace security group driver

---

# Kuryr-Kubernetes update (Stein)

## CRI-O Support

.center[.seventy[![Insert graphic here](assets/criologo.svg)]]

---

# Kuryr-Kubernetes update (Stein)

## What's CRI-O?

* More  ways to run containers than just the docker tool.
  * runc, rkt, frakti, cri-containerd and more.
  * Follow the OCI standard defining how the runtimes start and run containers
  * Lack a standard way of interfacing with an orchestrator
--

* Standard API to be able to talk to and manage a container runtime.
  * This API is called the **Container Runtime Interface (CRI)**
--

* Since 2018 CRI-O is an official part of the Kubernetes family of tools.

---

# CRI-O

## Why CRI-O?

* **Open Source Project**
  * Contributors from several companies, such as Red Hat, SUSE, Intel, Google, IBM...
--

* **Secure**
  * In Docker, every container is a ‘child’ of the large Docker Daemon
--

  * CRI-O containers are children of the process that spawned it
--

* **Lightweight**
--

* **Official Kubernetes Project**

---

# Kuryr-Kubernetes update (Stein)
## Basic scenario for SR-IOV

```yaml
apiVersion: extensions/v1beta1
kind: Deployment
spec:
  template:
    metadata:
      <snipped!>
      annotations:
        k8s.v1.cni.cncf.io/networks: net-sriov
    spec:
      containers:
        <snipped!>
        resources:
          requests:
            intel.com/sriov: '1'
          limits:
            intel.com/sriov: '1'
```
---

# Kuryr-Kubernetes update (Stein)
## SR-IOV features on the review

* Arbitrary resource names
```yaml
	resources:
	  requests:
	    arbitrary_prefix1/any_sriov_name1: '1'
	    arbitrary_prefix2/any_sriov_name2: '1'
	  limits:
	    arbitrary_prefix1/any_sriov_name1: '1'
	    arbitrary_prefix1/any_sriov_name2: '1'
```

* Bind user space driver for DPDK

```ini
	[sriov]
	resource_driver_mappings = user_driver_res_name:vfio-pci
	resource_driver_mappings = kernel_driver_res_name:igbvf

```
---

template: section_layout

Kuryr-Kubernetes future (Train, …)

---

# Kuryr-Kubernetes future (Stein, Train, …)

## What's going on on origin/master

Done (mostly) :

* Python 3.6 support
* UDP services support
* Upgrades checks
* SR-IOV support
* Network Policy support

--

In progress:

* DPDK support
* Multus support

---

# Kuryr-Kubernetes

## How to use, how to contribute

* Documentation: https://docs.openstack.org/kuryr-kubernetes/latest
* IRC channel: [#openstack-kuryr@Freenode](irc://chat.freenode.net/openstack-kuryr)
* Bugs: https://bugs.launchpad.net/kuryr-kubernetes
* How to contribute: https://wiki.openstack.org/wiki/How_To_Contribute

---

template: section_layout

![CC](assets/cc.svg)
.medium-text[
Slides are available on

http://creativecommons.org/licenses/by/4.0/
]

---

template: thank_you

# Q&A

## Thank you!

**Slides can be found at:**

- https://danielmellado.github.io/kuryr-stein-update
- https://github.com/danielmellado/kuryr-stein-update

**Daniel Mellado**

![email](assets/email.png)   [dmellado@redhat.com](mailto:dmellado@redhat.com)
![irc](assets/irc.png)   [dmellado (freenode)](irc://chat.freenode.net/dmellado,isnick)


    </textarea>
    <script src="remark.js" type="text/javascript"></script>
    <script type="text/javascript">
      var slideshow = remark.create({
        ratio: '16:9',
        slideNumberFormat: '%current%   <span class="designator">Kuryr - Project Update · April 2019 · Open Infrastructure Summit Denver</span>',
        countIncrementalSlides: false
      });
    </script>
  </body>
</html>

<!-- vim: set ft=markdown : -->
